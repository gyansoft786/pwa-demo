import{d as T,e as M,f as V,g as N,h as L,i as A,k as B}from"./chunk-R43ANWX3.js";import"./chunk-LX3SISR5.js";import{x as I,y as b}from"./chunk-LG33HJ7K.js";import"./chunk-K2WS7XYY.js";import{Cb as d,Eb as m,Pb as l,Qb as P,Rb as v,Tb as E,Va as c,cb as p,f as _,g as F,ia as k,jb as y,ob as C,ra as u,sa as f,sb as D,tb as H,ub as h,vb as w,wb as r,xb as o,zb as g}from"./chunk-AO5Y7OM7.js";function R(a,t){if(a&1){let e=g();r(0,"div",1),l(1),r(2,"button",2),d("click",function(){u(e);let n=m(2);return f(n.createDir())}),r(3,"mat-icon"),l(4,"create_new_folder"),o()(),r(5,"button",2),d("click",function(){u(e);let n=m(2);return f(n.createFile())}),r(6,"mat-icon"),l(7,"create_new_file"),o()()()}if(a&2){let e,i=m(2);c(),v("",((e=i.activeDirHandle())==null?null:e.name)||"Root Directory"," ")}}function W(a,t){if(a&1){let e=g();r(0,"mat-list-item")(1,"mat-icon",3),d("click",function(){let n=u(e).$implicit,s=m(2);return f(s.onItemClick(n))}),l(2),o(),r(3,"div",4),l(4),r(5,"mat-icon",5),d("click",function(){let n=u(e).$implicit,s=m(2);return f(s.deleteItem(n))}),l(6,"delete"),o()()()}if(a&2){let e=t.$implicit;c(2),P(e.kind=="directory"?"folder":"insert_drive_file"),c(2),v("",e.name," ")}}function j(a,t){a&1&&(r(0,"mat-list-item")(1,"span",4),l(2,"This folder is empty"),o()())}function q(a,t){if(a&1&&(r(0,"mat-list"),y(1,R,8,1,"div",1),h(2,W,7,2,"mat-list-item",null,H,!1,j,3,0,"mat-list-item"),o()),a&2){let e,i=m();c(),D(((e=i.activeDirHandle())==null?null:e.kind)=="directory"?1:-1),c(),w(i.activeEntries())}}var O=class a{fsStack=p([]);rootFolder=p(null);activeDirHandle=p(null);activeEntries=p([]);ngOnInit(){navigator.storage.getDirectory().then(t=>{this.rootFolder.set(t),this.activeDirHandle.set(this.rootFolder()),this.fsStack.update(e=>(e.push(this.rootFolder()),e)),this.setActiveEntries(this.rootFolder())})}setActiveEntries(t){return _(this,null,function*(){let e=[],i=t.entries();try{for(var n=F(i),s,S,x;s=!(S=yield n.next()).done;s=!1){let[z,$]=S.value;e.push($)}}catch{x=[S]}finally{try{s&&(S=n.return)&&(yield S.call(n))}finally{if(x)throw x[0]}}this.activeEntries.set(e)})}createDir(){return _(this,null,function*(){let e=prompt("New folder name")?.trim();if(e){let i=yield this.activeDirHandle()?.getDirectoryHandle(e,{create:!0});i&&this.activeEntries.update(n=>(n.push(i),n))}})}createFile(){return _(this,null,function*(){let e=prompt("New file name (.txt)")?.trim();if(!e)return;let i=yield this.activeDirHandle()?.getFileHandle(e,{create:!0});if(!i)return;let s=prompt("Enter file content")?.trim();if(!s)return;let S=yield i.createWritable({keepExistingData:!1});yield S.write(s),yield S.close(),this.activeEntries.update(x=>(x.push(i),x))})}onItemClick(t){return _(this,null,function*(){if(t.kind==="directory")this.activeDirHandle.set(t),this.fsStack.update(e=>(e.push(t),e)),this.setActiveEntries(t);else{let i=yield t.getFile(),n=new FileReader;n.onload=s=>{let S=s.target?.result;alert(S)},n.readAsText(i)}})}backBtnClick(){this.fsStack.update(t=>{t.pop();let e=t.at(-1);return e&&(this.activeDirHandle.set(e),this.setActiveEntries(e)),t})}deleteItem(t){confirm("Delete "+t.name)&&(this.activeDirHandle()?.removeEntry(t.name,{recursive:!0}),this.activeEntries.update(e=>{let i=e.findIndex(n=>n.isSameEntry(t));return i!==-1&&e.splice(i,1),e}))}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=k({type:a,selectors:[["app-persistent-data-storage"]],standalone:!0,features:[E],decls:5,vars:2,consts:[["mat-flat-button","",3,"click","disabled"],["mat-subheader",""],["mat-icon-button","",3,"click"],["matListItemIcon","",3,"click"],["matListItemTitle",""],[3,"click"]],template:function(e,i){e&1&&(r(0,"h3"),l(1,"File System"),o(),r(2,"button",0),d("click",function(){return i.backBtnClick()}),l(3,"Back"),o(),y(4,q,5,2,"mat-list")),e&2&&(c(2),C("disabled",i.fsStack().length<=1),c(2),D(i.activeDirHandle()?4:-1))},dependencies:[b,I,T,B,N,L,V,A,M]})};export{O as PersistentDataStoragePage};
